
{% extends 'layout.html' %}

{% block content %}
<style>
    .homepage{background: #fff}
    .yiding{background-color: #f1f4f6; padding: 0 10px;}
    .yiding:hover{
        background-color:rgb(133,107,255);
        color: #fff;
        font-weight: 400;
    }

    .yiding img{margin: 0}
    @font-face {
        font-family: 'iconfont';  /* project id 1595395 */
        src: url('//at.alicdn.com/t/font_1595395_cdlhji4whij.eot');
        src: url('//at.alicdn.com/t/font_1595395_cdlhji4whij.eot?#iefix') format('embedded-opentype'),
        url('//at.alicdn.com/t/font_1595395_cdlhji4whij.woff2') format('woff2'),
        url('//at.alicdn.com/t/font_1595395_cdlhji4whij.woff') format('woff'),
        url('//at.alicdn.com/t/font_1595395_cdlhji4whij.ttf') format('truetype'),
        url('//at.alicdn.com/t/font_1595395_cdlhji4whij.svg#iconfont') format('svg');
    }
    .iconfont{ font-family:"iconfont"
    !important; font-size:14px;font-style:normal; -webkit-font-smoothing: antialiased; -webkit-text-stroke-width: 0.2px; -moz-osx-font-smoothing: grayscale;}
</style>
<section id="blog" class="container" style="padding: 20px 0; background: #fff">
<div class="blog">
    <div class="row">
        <div class="col-md-8"> <!--main-->

            <div class="tab-wrap" v-for= "(q,index) in questions" style="border: 1px solid #ebeced;">
            <div class="parrent media-body" >
                <div class="tab-content" style="padding: 0">
                    <div class="tab-pane fade  active in" id="tab1">
                        <h2 style="padding: 0 20px; box-sizing: border-box; margin-top: 20px;"><a v-bind:href="'/zlj/answer.html?questionid='+q._id">{{q.title}}</a></h2>
                        <p class="huida" style="padding: 0 20px; box-sizing: border-box">{{q.answerCount}}回答</p>
                        <div v-for="item in q.answers" class="anwersuser">
                           <div class="userinfo" style="padding: 0 20px; box-sizing: border-box"><img :src="item.author.avatar" alt="" class="userimg"><i>{{item.author.name.first}}</i>|  <i style="margin-left: 0">{{item.createTime}}</i>  </div>
                            <div class="media" style="padding: 0 20px; box-sizing: border-box">
                                <div class="pull-left" style="width:124px;height:124px; no-repeat center center">
                                    <img class="img-responsive" v-bind:src="item.thumbnail||'/static/img/132465.jpg'" style="width: 190px; height: 124px;margin-left: 10px;">
                                </div>
                                <div class="media-body" style="margin-bottom: 10px; min-height: 150px;">

                                    <p class="neirong" style="color: #7f7d8e;">{{item.content|HtmltoText}}</p>
                                    <div @click="answerlike(item,index)" style="display: inline-block; height: 25px; overflow: hidden; line-height: 25px; margin-top: 10px; border-radius: 3px; float: left" class="yiding">
                                        <!--<img :src="'/static/img/x1.png'" alt=""  class="xinzan" style="width: 15px; height: 15px; margin-right: 3px;">-->
                                        <!--<img :src="'/static/img/x.png'" alt="" class="xinzan" style="width: 15px; height: 15px;margin-right: 3px;" v-else>-->
                                        <i class="iconfont" style="color: red;" v-if="mylikes[index]==1">&#xe602;</i>
                                        <i class="iconfont" style="color: #fff"  v-else>&#xe602;</i>
                                        {{item.likeCount|Countfilter}}
                                    </div>
                                    <div @click="answerlike(item,index)" style="display: inline-block; height: 25px; overflow: hidden; line-height: 25px; margin-top: 10px;margin-left: 10px;border-radius: 3px;float: left" class="yiding" id="pl">
                                       <i class="iconfont" style="color: #fff;font-size: 18px; line-height: 15px; float: left; margin-top: 6px;">&#xe606;</i>
                                        {{item.commentCount|Countfilter}}
                                    </div>
                                </div>
                            </div>





                        </div>

                    </div>


                </div> <!--/.tab-content-->
            </div>
        </div> <!--tab-wrap-->






        </div> <!-- col-md-8-->
        <aside class="col-md-4"> <!-- right-->
            <img src="/static/img/987654.jpg" alt="" class="tup">
        </aside> <!-- col-md-4-->
    </div> <!--row -->
</div> <!--blog-->
    <div class="loader" style="background: #fff; z-index: 99999;margin: 0;" v-if="loading==1">

        <div class="loading-2">
            <i></i>
            <i></i>
            <i></i>
            <i></i>
            <i></i>
        </div>
    </div>
</section>


{% endblock %}

{% block externjs %}
<script src="/corlate/js/jquery.prettyPhoto.js"></script>
<script src="/corlate/js/jquery.isotope.min.js"></script>
<script src="/corlate/js/main.js"></script>
<script src="/corlate/js/wow.min.js"></script>
<script>
$(document).ready(function () {

  var myVue = new Vue({
    el: '#blog',
	data:{
        questions:[],
        mylikes:[],
        loading:1,
        user:{'id':'<%= user.id%>','avatar':'<%=user.avatar%>','name':'<%=user.name%>',}, //swig templates by express
    },
    created () {
    	this.getQuestions()
  	},
    methods: {
        getQuestions(){
            var that = this
            $.ajax({url:"/zlj/listquestion",
                type: 'GET',
                success: function(data){
                    that.questions = data.questions
                    that.mylikes = data.userlikes
                    console.log(that.questions);
                    that.loading=0
                }
            })//ajax
        },
        answerlike (a,index) {
            var that = this;
            console.log(a._id);

            if (that.mylikes[index] == 1){
                that.mylikes[index] = 0
            } else {
                that.mylikes[index] = 1
            }

            $.ajax({url:"/zlj/answerlike?answerid=" +a._id,
                type: 'GET',
                success: function(data){
                    console.log(that)
                    a.likeCount = data.updatedObject.likeCount
                }
            })//ajax
        },
    },
  });

  Vue.filter('Countfilter',function(count){
      if (count < 0){
          return 0
      } else {
          return count
      }
  })

  function HtmltoText(str){
      return str.replace(/<[^>]+>/g,"");//去掉所有的html标记
  }
  Vue.filter('HtmltoText',HtmltoText)
})
</script>
{% endblock %}
